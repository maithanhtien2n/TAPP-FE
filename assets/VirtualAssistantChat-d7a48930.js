import{c as j,o as s,d as n,e as t,t as N,z as v,n as M,A as G,u as L,a1 as U,R as _,q as H,L as O,x as z,J as h,v as T,f as D,F as A,y as E,g,B,a2 as S,C as F,a3 as I,w as K,G as J}from"./index-11f99f67.js";import{_ as W}from"./ButtonBack-6f0fb4ee.js";const P={class:"flex gap-2"},Q=["src"],X={class:"flex flex-column gap-1 w-full"},Y={class:"font-bold text-800"},Z=["innerHTML"],V={__name:"UserChat",props:{image:{type:String,required:!1,default:""},name:{type:String,required:!1,default:""},message:{type:String,required:!1,default:""}},setup(r){return(x,y)=>{const l=j("Skeleton");return s(),n("div",P,[t("img",{class:"w-2rem h-2rem border-circle object-fit-cover box-shadow-1",src:r.image||"https://bloganchoi.com/wp-content/uploads/2022/02/avatar-trang-y-nghia.jpeg",alt:"Lỗi ảnh"},null,8,Q),t("div",X,[t("span",Y,N(r.name),1),r.message?(s(),n("div",{key:0,innerHTML:r.message,style:{"text-align":"justify","white-space":"pre-wrap"},class:"text-800 line-height-3"},null,8,Z)):(s(),v(l,{key:1,class:"w-full mt-2",height:"4rem"}))])])}}},ee=t("br",null,null,-1),te=t("br",null,null,-1),se={style:{"max-width":"40rem"},class:"flex flex-column gap-4 m-auto w-full h-full pb-6"},ae={key:1,class:"flex h-full justify-content-center align-items-center"},ne={class:"flex flex-column gap-3 align-items-center"},le=t("img",{class:"w-10rem h-10rem",src:"https://cdn-icons-png.flaticon.com/512/1698/1698535.png",alt:"Lỗi ảnh"},null,-1),oe={class:"text-center line-height-2"},ie={class:"text-main-color"},re={style:{bottom:"1.8rem"},class:"fixed z-5 left-0 right-0 px-3 bg-white"},ce={style:{"max-width":"50rem"},class:"p-3 border-round-3xl box-shadow-1 flex bg-white m-auto flex-1"},ue=["onKeypress"],me={style:{"padding-left":"0.7rem"},class:"border-left-1 text-400"},de={key:0,class:"pi pi-spin pi-spinner text-900"},fe={__name:"VirtualAssistantChat",setup(r){const x=M(),y=G(),l=L(),{onGetterMessages:o,onActionChat:C,onActionCheckLinkChat:R,onActionGetVirtualAssistant:q}=U(),c=_(""),i=_(!1),f=_(!1),p=H(()=>y.query.id),m=()=>{setTimeout(()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})},1)},w=e=>{switch(e){case"user":return{image:"/images/avatar-you.png",name:"Bạn"};case"assistant":return{image:"/images/avatar-bot.jpg",name:"Bot"};default:return""}},$=()=>{if(!T.value){l.replace({name:"Home"});return}o.value=[],l.replace({name:"VirtualAssistant"})},b=async()=>{if(i.value)return;let e="";e=c.value,c.value="",o.value.push({role:"user",content:e}),m(),i.value=!0,C({userId:p.value,contents:o.value}).then(u=>{o.value.push(u.data),m(),i.value=!1}).catch(()=>{i.value=!1})};return O(i,e=>{e?setTimeout(()=>{f.value=!0,m()},600):f.value=!1}),z(async()=>{var a,d,k;const e=await R(p.value);if(e.success)h.value.fullName=((a=e==null?void 0:e.data)==null?void 0:a.fullName)||"",h.value.userName=((d=e==null?void 0:e.data)==null?void 0:d.userName)||"";else{l.replace({name:"NotFound"});return}if(m(),!T.value)return;if(!((k=(await q(p.value,!0)).data)!=null&&k.system)){x.info("Bot không thể hoạt động khi chưa được cấu hình!"),l.replace({name:"VirtualAssistant"});return}}),(e,u)=>(s(),n(A,null,[D(W,{onOnClick:$}),ee,te,t("div",se,[(s(!0),n(A,null,E(g(o),(a,d)=>(s(),v(V,{key:d,image:w(a.role).image,name:w(a.role).name,message:a.content},null,8,["image","name","message"]))),128)),f.value?(s(),v(V,{key:0,image:"/images/avatar-bot.jpg",name:"Bot"})):B("",!0),g(o).length?B("",!0):(s(),n("div",ae,[t("div",ne,[le,t("span",oe,[S(" Chào bạn, tôi là chat bot do "),t("span",ie,N(g(h).fullName||g(h).userName),1),S(" tạo ra! ")])])]))]),t("div",re,[t("div",ce,[F(t("input",{"onUpdate:modelValue":u[0]||(u[0]=a=>c.value=a),type:"text",class:"w-full border-none outline-none",placeholder:"Bạn muốn hỏi gì?",onKeypress:K(b,["enter"])},null,40,ue),[[I,c.value]]),t("div",me,[i.value?(s(),n("i",de)):(s(),n("i",{key:1,class:J(["pi pi-angle-right text-900 on-click",{"p-disabled":!c.value}]),onClick:b},null,2))])])])],64))}};export{fe as default};

import{c as m,o as _,d as v,e as o,t as S,C,D as x,f as t,g as N,E as Z,G as O,H as ee,_ as te,I as G,r as M,q as B,J as R,K as ae,b as ne,L as F,x as H,n as oe,M as se,N as h,F as E,y as le,w as re,O as ie,z as q,B as K}from"./index-3fb98db6.js";import{c as ce,a as $,_ as j}from"./InputTextValidate-db524601.js";import{a as de,u as ue}from"./vee-validate.esm-7bbebb17.js";import{_ as z}from"./IconTitle-13c9c71f.js";import{_ as pe}from"./ImageValidate-ef94c791.js";const me={class:"p-error"},he={class:"flex flex-column gap-1 w-full"},fe={__name:"DropdownValidate",props:{name:{type:String,required:!0,default:""},label:{type:String,required:!1,default:""},options:{type:Array,required:!1,default:""},class:{type:String,required:!1,default:""},style:{type:Object,required:!1,default:()=>{}},disabled:{type:Boolean,required:!1,default:!1},placeholder:{type:String,required:!1,default:""},dropdownProps:{type:Object,required:!1,default:()=>({optionLabel:"name",optionValue:"code",placeholder:"",class:"",required:!0})}},emits:["onChange"],setup(T,{emit:b}){const n=T,{value:d,errorMessage:u,setErrors:y,setValue:L}=de(n.name);return(P,e)=>{const w=m("Dropdown");return _(),v("div",{class:O(["flex flex-column gap-2",n.class]),style:ee(n.style)},[o("label",null,[o("span",null,S(n.label),1),C(o("span",me,"*",512),[[x,n.dropdownProps.required]])]),o("div",he,[t(w,{modelValue:N(d),"onUpdate:modelValue":e[0]||(e[0]=f=>Z(d)?d.value=f:null),options:n.options,optionLabel:n.dropdownProps.optionLabel,optionValue:n.dropdownProps.optionValue,placeholder:n.placeholder,class:O(n.dropdownProps.class),disabled:n.disabled,onChange:e[1]||(e[1]=f=>b("onChange"))},null,8,["modelValue","options","optionLabel","optionValue","placeholder","class","disabled"]),C(o("small",{class:"p-error"},S(N(u)),513),[[x,N(u)]])])],6)}}};const _e={class:"flex flex-column gap-4"},be={class:"flex flex-wrap-reverse gap-6"},ge={style:{"max-width":"25rem"},class:"flex-1 flex flex-column gap-3"},ye={class:"image-container w-25rem flex flex-column gap-3"},ve={__name:"AccountInfoUser",setup(T){const{onGetterUserInfo:b,onActionGetUserInfo:n,onActionSaveUserInfo:d}=G(),u=M({avatar:null,fullName:"",phoneNumber:null,gender:""}),y=B(()=>R.value._id),L=ce({fullName:$().required("Vui lòng nhập họ và tên"),phoneNumber:$().test("phoneNumber","Vui lòng nhập đúng định dạng số điện thoại",s=>s.length>=10&&s.length<=12&&ae(s)).required("Vui lòng nhập số điện thoại"),gender:$().required("Vui lòng chọn giới tính")}),{values:P,resetForm:e,setFieldValue:w,handleSubmit:f}=ue({initialValues:u,validationSchema:L,keepValuesOnUnmount:!0}),k=f(async()=>{(await d(y.value,P)).success&&n(y.value,!0).then(g=>{g.success&&(ne.value.userData=g==null?void 0:g.data)})});return F(b,s=>{e({values:Object.assign(u,s)}),s.avatar&&w("avatar",{name:s==null?void 0:s.avatar.split("$")[1],base64:s==null?void 0:s.avatar})}),H(()=>{n(y.value)}),(s,g)=>{const U=m("Button");return _(),v("div",_e,[t(z,{icon:"pi pi-user",title:"Thông tin tài khoản"}),o("div",be,[o("div",ge,[t(j,{label:"Họ và tên",name:"fullName",class:"w-full",placeholder:"Họ và tên"}),t(j,{label:"Số điện thoại",name:"phoneNumber",class:"w-full",placeholder:"Số điện thoại",type:"number"}),t(fe,{label:"Giới tính",name:"gender",options:[{name:"Nam",code:"male"},{name:"Nữ",code:"female"},{name:"Khác",code:"other"}],placeholder:"Giới tính"}),t(U,{label:"Lưu thông tin",onClick:N(k)},null,8,["onClick"])]),o("div",ye,[t(pe,{label:"Ảnh đại diện",name:"avatar",class:"image w-10rem h-10rem",required:!1})])])])}}},we=te(ve,[["__scopeId","data-v-e1a180da"]]),ke={class:"flex flex-column gap-4"},Se={class:"flex flex-wrap gap-2 justify-content-between"},Ce={class:"flex gap-2"},xe={class:"p-input-icon-right w-20rem"},Ne=["onClick"],Te=["src"],Le=o("div",{class:"flex justify-content-center"}," Không tìm thấy kết quả nào ",-1),Pe={key:1},Ue={__name:"AccountInfoAdmin",setup(T){const b=oe(),n=se(),{onGetterListUser:d,onActionGetListUser:u,onActionUpdateMoneyBalanceUser:y,onActionUpdateStatusUser:L}=G(),P=[{name:"Tất cả",code:"ALL"},{name:"Đang hoạt động",code:"ACTIVE"},{name:"Đã khóa",code:"LOCKED"}],e=M({tabIndex:0,body:{pagination:{first:0,rows:5,sort:null},keySearch:""},topUpNumber:null,tableSelection:[]}),w=B(()=>{switch(e.tabIndex){case 0:return d.value.all;case 1:return d.value.active;case 2:return d.value.locked;default:return d.value.all}}),f=i=>e.tableSelection.map(l=>l[i]),k=i=>!f("status").includes(i),s=i=>{switch(i){case"male":return"Nam";case"female":return"Nữ";case"other":return"Khác";default:return""}},g=()=>{e.body.keySearch="",e.tableSelection=[]},U=(i,l)=>{u({tab:i,keySearch:l})},D=(i,l,c,{tab:I,keySearch:p})=>{if(f("status").includes(c==="TOPUP"?"LOCKED":c)){b.error("Vui lòng chỉ chọn dòng dữ liệu có trạng thái: "+i);return}n.require({message:`Bạn muốn ${l} tài khoản?`,header:c==="TOPUP"?"Nhập số tiền cần nạp":"Xác nhận",acceptLabel:c==="TOPUP"?"Nạp tiền":"Đồng ý",acceptClass:c==="LOCKED"?"p-button-danger":"",rejectLabel:"Hủy bỏ",rejectClass:"p-button-outlined",type:c,accept:async()=>{c==="TOPUP"?(await y({ids:f("_id"),moneyBalance:e.topUpNumber})).success&&(e.topUpNumber=null,e.tableSelection=[],u({tab:I,keySearch:p},!0)):(await L({ids:f("_id"),status:c})).success&&(e.tableSelection=[],u({tab:I,keySearch:p},!0))}})};return F(()=>e.body.keySearch,i=>{i||u({tab:"ALL",keySearch:""},!0)}),H(()=>{u({tab:"ALL",keySearch:""})}),(i,l)=>{const c=m("Button"),I=m("InputText"),p=m("Column"),V=m("StatusComponent"),J=m("DataTable"),X=m("TabPanel"),Q=m("TabView"),W=m("InputNumber"),Y=m("ConfirmDialog");return _(),v(E,null,[o("div",ke,[t(z,{icon:"pi pi-user",title:"Danh sách tài khoản"}),t(Q,{activeIndex:e.tabIndex,"onUpdate:activeIndex":l[2]||(l[2]=r=>e.tabIndex=r),onTabChange:g},{default:h(()=>[(_(),v(E,null,le(P,(r,A)=>t(X,{key:A,header:r.name},{default:h(()=>[t(J,{paginator:!0,selection:e.tableSelection,"onUpdate:selection":l[1]||(l[1]=a=>e.tableSelection=a),value:w.value,first:e.body.pagination.first,rows:e.body.pagination.rows,rowsPerPageOptions:[5,10,15,20],paginatorTemplate:" FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",currentPageReportTemplate:"Hiển thị {first} - {last} / tổng {totalRecords} dòng"},{header:h(()=>[o("div",Se,[o("div",Ce,[C(t(c,{label:"Mở khóa",disabled:k("LOCKED"),onClick:a=>D("đã khóa","mở khóa","ACTIVE",{tab:r.code,keySearch:e.body.keySearch})},null,8,["disabled","onClick"]),[[x,r.code!=="ACTIVE"]]),C(t(c,{label:"Khóa",class:"p-button-danger",disabled:k("ACTIVE"),onClick:a=>D("hoạt động","khóa","LOCKED",{tab:r.code,keySearch:e.body.keySearch})},null,8,["disabled","onClick"]),[[x,r.code!=="LOCKED"]]),C(t(c,{label:"Nạp tiền",severity:"secondary",disabled:k("ACTIVE"),onClick:a=>D("hoạt động","nạp tiền","TOPUP",{tab:r.code,keySearch:e.body.keySearch})},null,8,["disabled","onClick"]),[[x,r.code!=="LOCKED"]])]),o("span",xe,[o("i",{class:O([{"p-disabled":!e.body.keySearch},"pi pi-search on-click"]),onClick:a=>U(r.code,e.body.keySearch)},null,10,Ne),t(I,{modelValue:e.body.keySearch,"onUpdate:modelValue":l[0]||(l[0]=a=>e.body.keySearch=a),placeholder:"Tìm theo tên tài khoản",size:"small",class:"w-full",maxLength:"35",onKeypress:re(a=>U(r.code,e.body.keySearch),["enter"])},null,8,["modelValue","onKeypress"])])])]),empty:h(()=>[Le]),default:h(()=>[t(p,{selectionMode:"multiple",class:"max-w-5rem w-5rem"}),t(p,{field:"userName",header:"Tên tài khoản",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0}),t(p,{field:"avatar",header:"Ảnh đại diện",class:"white-space-nowrap",style:{width:"7rem"}},{body:h(({data:a})=>[o("img",{class:"w-4rem h-4rem object-fit-cover box-shadow-1",src:a.avatar||"/images/avatar.jpg",onerror:"this.onerror=null; this.src='/images/avatar.jpg';"},null,8,Te)]),_:1}),t(p,{field:"fullName",header:"Họ và tên",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0}),t(p,{field:"phoneNumber",header:"Số điện thoại",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0}),t(p,{field:"gender",header:"Giới tính",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0},{body:h(({data:a})=>[o("span",null,S(s(a.gender)),1)]),_:1}),t(p,{field:"moneyBalance",header:"Số dư",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0},{body:h(({data:a})=>[o("span",null,S(N(ie)(a.moneyBalance)),1)]),_:1}),t(p,{field:"status",header:"Trạng thái",class:"white-space-nowrap",style:{width:"7rem"},sortable:!0},{body:h(({data:a})=>[t(V,{code:a==null?void 0:a.status},null,8,["code"])]),_:1})]),_:2},1032,["selection","value","first","rows"])]),_:2},1032,["header"])),64))]),_:1},8,["activeIndex"])]),t(Y,{class:"line-height-3"},{message:h(r=>[r.message.type==="TOPUP"?(_(),q(W,{key:0,modelValue:e.topUpNumber,"onUpdate:modelValue":l[3]||(l[3]=A=>e.topUpNumber=A),class:"w-full",currency:"VND",locale:"vn-VN"},null,8,["modelValue"])):(_(),v("span",Pe,S(r.message.message),1))]),_:1})],64)}}},Oe={__name:"AccountInfo",setup(T){const b=B(()=>R.value.role);return(n,d)=>(_(),v("div",null,[b.value==="USER"?(_(),q(we,{key:0})):K("",!0),b.value==="ADMIN"?(_(),q(Ue,{key:1})):K("",!0)]))}};export{Oe as default};
